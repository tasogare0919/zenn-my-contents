---
title: "esa ã§è¨˜äº‹ã®å®šæœŸæŠ•ç¨¿ã‚’è‡ªå‹•åŒ–ã™ã‚‹ãŸã‚ã«ã‚„ã£ãŸã“ã¨"
emoji: "ğŸ¥"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [esa,Python,Slack]
published: false
---
ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¨ã—ã¦[esa](https://esa.io/)ã‚’ä½¿ã£ã¦ã„ã‚‹ã‚“ã§ã™ãŒ,å®šæœŸãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®è­°äº‹éŒ²ã‚’ä½œã£ã¦ Slack ã®é–¢ä¿‚è€…ã«é€šçŸ¥ã—ã¦ã„ã¾ã™.å®šæœŸçš„ã«ä½œã‚‹ã®ã§è­°äº‹éŒ²ã®å†…å®¹ã‚’ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆåŒ–ã—,è­°äº‹éŒ²ä½œæˆã¯æŒ‡å®šæ™‚é–“ã«æŠ•ç¨¿ã™ã‚‹ä»•çµ„ã¿ã‚’ä½œã‚ŠãŸã„ã¨ã„ã†ã“ã¨ã§ã‚„ã£ã¦ã¿ã¾ã—ãŸ.

# esa ã® API
esa ã® API ã¯ä¸‹è¨˜ã§å…¬é–‹ã•ã‚Œã¦ã¾ã™.ã“ã® API ã‚’ä½¿ã£ã¦ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã¾ã—ãŸ.

[API](https://docs.esa.io/posts/102#GET%20/v1/teams/:team_name/posts)

# å®Ÿéš›ã®ã‚³ãƒ¼ãƒ‰ä¾‹
ã‚³ãƒ¼ãƒ‰ã¯ Python 3.9 ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ä½œã£ã¦ã¾ã™.

```python
import requests
from requests.auth import AuthBase
import json
import slackweb
import datetime

TOKEN = 'esaã®ãƒˆãƒ¼ã‚¯ãƒ³'
TEAM_NAME = 'ãƒãƒ¼ãƒ å'

session = requests.session()
session.headers['Authorization'] = 'Bearer {}'.format(TOKEN)
session.headers['Content-Type'] = 'application/json'
api_endpoint = 'https://api.esa.io'


body = dict(
        post=dict(
            category='è­°äº‹éŒ²ã‚’ä½œã‚‹ãƒ‘ã‚¹',
            template_post_id=xxx,
            wip=False)
            )
response = session.post('{}/v1/teams/{}/posts'.format(api_endpoint, TEAM_NAME), data=json.dumps(body).encode('utf-8'))
json_result = response.json()
esa_url = json_result['url']

slack=slackweb.Slack(url="https:/incoming webhook ã® URL")
member = ['xxx', 'xxx', 'xxx'] # ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³ã® ID
mention_list = []
for i in member:
    mention_list.append("<@" + i + ">")
mention_str = map(str, mention_list)
mention_name = ' '.join(mention_str)

slack.notify(text=mention_name + "ä»Šé€±ã®è­°äº‹éŒ²ã§ã™\n" + esa_url, channel="#æŠ•ç¨¿ã®ãƒãƒ£ãƒ³ãƒãƒ«", username="è­°äº‹éŒ²é€šçŸ¥bot", icon_emoji=":esa:", mrkdwn=True)
```
## æŠ•ç¨¿ã•ã‚ŒãŸå†…å®¹
ã“ã‚“ãªæ„Ÿã˜ã§ãƒã‚¹ãƒˆã•ã‚Œã¾ã™.ã“ã‚Œã§æ¯é€±è­°äº‹éŒ²ã‚’ä½œã‚‹æ‰‹é–“ãŒçœã‘ã¾ã—ãŸ.

![](https://storage.googleapis.com/zenn-user-upload/00f339n9mogydgn0lfm12bkvlgl0)